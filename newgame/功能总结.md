# 项目功能总结

## 🎮 核心游戏系统

### main.py - 游戏主循环
- **游戏核心控制器**：管理整个游戏的生命周期和主循环
- **双模式运行**：支持编辑模式（TAB切换）和游戏模式
- **模块协调**：协调所有operon模块之间的数据流动
- **相机系统**：实现跟随玩家的无限横向滚动相机
- **事件处理**：统一处理用户输入和游戏事件
- **地图编辑器**：内置地图编辑功能，可实时编辑地图、生成点、交互点

---

## 🧬 操纵子模块 (Operons)

### 1. input_operon.py - 输入处理
- **键盘输入**：A/D移动、空格跳跃、E交互、1/2切换副武器、Shift翻滚
- **鼠标输入**：左键主武器1、右键主武器2、长按触发技能攻击
- **编辑器快捷键**：Ctrl+S保存地图、Shift+Space添加近战生成点、Shift+W添加武器生成点
- **交互点编辑**：Shift+D添加门、Shift+Q添加卷轴、Shift+C添加宝箱
- **输入标准化**：将所有输入转换为标准化的动作字典

### 2. movement_operon.py - 移动与物理
- **玩家角色**：管理玩家位置、速度、状态
- **物理系统**：重力、跳跃、水平移动、碰撞检测
- **翻滚机制**：Shift键翻滚，翻滚期间无敌，固定距离和持续时间
- **永久升级**：速度、伤害、跳跃力的永久加成系统
- **交互处理**：处理与宝箱、卷轴、门的交互
- **通知系统**：管理玩家收到的各种通知消息

### 3. weapon_operon.py - 武器系统
- **4槽位武器系统**：
  - main_1: 基础剑（近战）
  - main_2: 基础弓（远程）
  - sub_1: 炸弹（范围伤害）
  - sub_2: 治疗药水（3次使用）
- **攻击类型**：
  - 普通攻击：点击鼠标左键/右键
  - 技能攻击：长按鼠标0.5秒以上
- **稀有武器**：火焰剑、冰霜弓（从宝箱获得）
- **方向瞄准**：智能的鼠标位置瞄准系统，支持方向记忆
- **技能冷却**：炸弹30秒冷却时间
- **宝箱奖励**：处理宝箱开启后的武器奖励

### 4. combat_operon.py - 战斗系统
- **生命系统**：管理所有实体的生命值
- **投射物系统**：箭矢、子弹等飞行物物理模拟
- **伤害计算**：支持伤害倍率、无敌帧、伤害类型
- **视觉效果**：爆炸、攻击效果的时间渲染
- **攻击类型处理**：
  - 近战攻击：瞬发伤害，有攻击范围和持续时间
  - 投射物攻击：飞行物碰撞检测
  - 范围效果：爆炸、范围伤害
  - 治疗效果：立即恢复生命值
- **门伤害**：攻击可以破坏门

### 5. enemy_operon.py - 敌人系统
- **三种敌人类型**：
  - **近战敌人**（红色）：接近玩家并近战攻击
  - **远程敌人**（绿色）：保持距离并发射投射物
  - **护盾敌人**（蓝色）：随机开启护盾状态
- **AI行为**：移动、攻击、状态切换
- **攻击系统**：独立的攻击冷却和伤害计算
- **生命管理**：与combat_operon集成的生命系统

### 6. map_operon.py - 地图管理
- **无限横向地图**：支持超长地图的横向滚动
- **网格系统**：32x32像素的瓦片网格
- **地图元素**：
  - 空地（0）：可通过区域
  - 碰撞体（1）：墙壁和障碍物
  - NPC区域（2）：NPC生成区域
- **生成点管理**：
  - 敌人生成点：近战、远程
  - 武器生成点：武器掉落
- **交互点系统**：
  - 门（1x3垂直）：可开关、可破坏
  - 宝箱（2x2方形）：开启后获得武器
  - 卷轴（2x4垂直）：收集后获得永久升级
- **地图编辑**：实时编辑地图瓦片、添加/删除生成点和交互点
- **自动合并**：相邻的同类型交互点自动合并为组合
- **地图保存/加载**：JSON格式的完整地图数据持久化

### 7. npc_operon.py - NPC系统
- **三种NPC类型**：
  - 武器商（黄色）：提供武器交易
  - 技能导师（青色）：教授技能
  - 升级商（紫色）：提供永久升级
- **交互系统**：E键触发NPC对话
- **位置管理**：固定的新手村NPC位置

### 8. ui_operon.py - 界面渲染
- **生命条**：所有实体的实时生命条显示
- **升级信息**：显示玩家的永久升级加成
- **通知系统**：卷轴收集、武器获得、升级提示
- **技能信息**：炸弹冷却时间、治疗药水剩余数量
- **颜色编码**：不同类型信息使用不同颜色显示

### 9. generation_operon.py - 关卡生成
- **程序化生成**：基于布局字典生成关卡
- **敌人生成**：根据生成点创建敌人
- **扩展性**：预留道具生成接口

### 10. interactable_operon.py - 交互对象
- **可交互对象基类**：交互冷却、碰撞检测
- **门对象**：可开关、可破坏、阻挡移动
- **宝箱对象**：开启后获得武器或生成敌人
- **卷轴对象**：收集后获得属性提升
- **群体管理**：相邻相同类型对象的自动分组

### 11. progression_operon.py - 成长系统
- **属性管理**：最大生命值、伤害修正、移动速度、幸运值
- **经验系统**：经验值积累和等级管理
- **卷轴加成**：随机属性永久提升
- **数据驱动**：完全独立的属性管理系统

### 12. resource_operon.py - 资源管理
- **图片加载**：带缓存的图片资源管理
- **地图路径**：地图文件路径管理
- **字体管理**：字体资源的缓存和加载
- **路径构建**：统一的资源路径构建系统

---

## 🎯 游戏玩法特性

### 核心循环
1. **探索**：横向滚动的无限地图
2. **战斗**：近战/远程攻击、技能释放
3. **收集**：卷轴（永久升级）、宝箱（新武器）
4. **成长**：属性提升、武器解锁
5. **重复**：Roguelite式的重复游戏循环

### 战斗系统
- **双攻击模式**：普通攻击 + 技能攻击
- **武器多样**：近战、远程、范围、治疗
- **敌人AI**：三种不同行为模式的敌人
- **翻滚无敌**：策略性的无敌帧机制

### 升级系统
- **永久升级**：卷轴提供的永久属性提升
- **武器收集**：从宝箱获得稀有武器
- **属性加成**：速度、伤害、跳跃力倍率

### 地图编辑
- **实时编辑**：编辑模式下实时修改地图
- **丰富元素**：瓦片、生成点、交互点
- **自动保存**：Ctrl+S保存地图数据
- **可视化编辑**：不同颜色表示不同元素类型

### 界面系统
- **实时信息**：生命条、升级信息、通知
- **技能状态**：冷却时间、使用次数
- **视觉效果**：攻击效果、爆炸动画

---

## 🔧 技术特色

### 细菌式架构
- **模块独立**：每个operon完全独立，可单独测试
- **低耦合**：通过标准化字典通信，无直接调用
- **高内聚**：每个模块职责单一，功能聚焦
- **热插拔**：模块可以轻松替换和扩展

### 数据驱动
- **配置驱动**：通过配置文件控制游戏行为
- **事件系统**：通过事件驱动模块间通信
- **状态管理**：清晰的状态定义和转换

### 性能优化
- **视口裁剪**：只渲染屏幕可见内容
- **资源缓存**：图片、字体资源的智能缓存
- **碰撞优化**：基于网格的高效碰撞检测

这个游戏实现了一个完整的2D横版Roguelite游戏框架，具备战斗、探索、成长、编辑等核心功能，采用先进的模块化架构设计。